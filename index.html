<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Curlingov√© kluby ‚Äì mapa sveta (free)</title>
  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <!-- MarkerCluster (voliteƒæn√©, ale praktick√© pri stovk√°ch bodov) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
  />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
  />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <style>
    :root {
      --bg: #0b1020;
      --panel: #11162a;
      --muted: #8ea0b8;
      --text: #e7eef9;
      --accent: #4da3ff;
      --accent-2: #75f0c0;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--text); }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .app {
      display: grid;
      grid-template-columns: 360px 1fr;
      grid-template-rows: 64px 1fr;
      grid-template-areas:
        "header header"
        "sidebar map";
      height: 100%;
    }

    header {
      grid-area: header;
      display: flex; gap: 12px; align-items: center; padding: 12px 16px;
      background: linear-gradient(90deg, rgba(77,163,255,.15), rgba(117,240,192,.15));
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    header h1 { font-size: 18px; margin: 0; font-weight: 700; letter-spacing: .2px; }
    header .pill { padding: 6px 10px; background: rgba(255,255,255,.06); border-radius: 999px; font-size: 12px; color: var(--muted); }

    .sidebar {
      grid-area: sidebar;
      border-right: 1px solid rgba(255,255,255,.06);
      background: var(--panel);
      padding: 14px;
      overflow: auto;
    }

    .field { display: flex; gap: 8px; margin-bottom: 10px; }
    .field input, .field select {
      width: 100%; border: 1px solid rgba(255,255,255,.12); background: #0e1427; color: var(--text);
      padding: 10px 12px; border-radius: 10px; outline: none;
    }
    .field input::placeholder { color: #97a8c2; }

    .chips { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 10px; }
    .chip { font-size: 12px; padding: 6px 8px; background: #0e1427; border: 1px solid rgba(255,255,255,.12); border-radius: 999px; color: var(--muted); cursor: default; }

    .results {
      display: grid; gap: 10px;
    }
    .card {
      background: #0e1427; border: 1px solid rgba(255,255,255,.08); border-radius: 14px; padding: 12px;
    }
    .card h3 { margin: 0 0 4px; font-size: 16px; }
    .meta { color: var(--muted); font-size: 12px; }
    .btn-row { display: flex; gap: 8px; margin-top: 10px; }
    .btn { border: 1px solid rgba(255,255,255,.16); background: transparent; color: var(--text); padding: 8px 10px; border-radius: 10px; cursor: pointer; }
    .btn:hover { border-color: var(--accent); }

    #map { grid-area: map; height: 100%; width: 100%; }

    .detail { margin-top: 10px; }
    .detail h4 { margin: 16px 0 8px; font-size: 14px; color: var(--accent-2); }
    .list { list-style: none; padding: 0; margin: 0; display: grid; gap: 6px; }
    .list li { font-size: 14px; color: #cfe0ff; }

    .footer { font-size: 12px; color: var(--muted); margin-top: 12px; }
    .small { font-size: 12px; color: var(--muted); }

    /* Leaflet dark tweaks */
    .leaflet-container { background: #0a0f1f; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Mapa curlingov√Ωch klubov</h1>
      <span class="pill">100% zadarmo ‚Äì OSM + Leaflet</span>
    </header>

    <aside class="sidebar">
      <div class="field">
        <input id="search" type="search" placeholder="Hƒæadaj klub, mesto, krajinu‚Ä¶ (napr. Brno, Praha, Z√ºrich)" />
      </div>
      <div class="field">
        <select id="region">
          <option value="">üåç V≈°etky regi√≥ny</option>
          <option value="Europe">üá™üá∫ Eur√≥pa</option>
          <option value="North America">üá∫üá∏üá®üá¶ Severn√° Amerika</option>
          <option value="South America">üáßüá∑ Ju≈æn√° Amerika</option>
          <option value="Asia">üáØüáµ √Åzia</option>
          <option value="Africa">üåç Afrika</option>
          <option value="Oceania">üá¶üá∫ Oce√°nia</option>
        </select>
      </div>
      <div class="field">
        <select id="iceFilter">
          <option value="">üßä ƒΩad: neobmedzene</option>
          <option value=">=4">‚â• 4 dr√°hy</option>
          <option value=">=2">‚â• 2 dr√°hy</option>
          <option value="=1">= 1 dr√°ha</option>
        </select>
      </div>
      <div class="chips" id="stats"></div>
      <div class="results" id="results"></div>
      <div class="footer">
        Podklady mapy ¬© prispievatelia <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap</a>. 
        Vytvoren√© v <a href="https://leafletjs.com/" target="_blank" rel="noopener">Leaflet</a>. Hostuj na GitHub Pages/Netlify.
      </div>
    </aside>

    <div id="map"></div>
  </div>

  <script>
    // ===== 1) D√ÅTA ‚Äì uprav podƒæa seba (alebo naƒç√≠taj z JSON/Google Sheets) =====
    // Sch√©ma klubu
    // id: unik√°tne ID
    // name, country, city, region (kontinent), lat, lng
    // venue: { sheets (poƒçet dr√°h), indoor (true/false), address, opened }
    // website, notes
    // tournaments: pole udalost√≠ { title, start (YYYY-MM-DD), end?, city?, url?, notes? }

    const clubs = [
      {
        id: "cze-brno-olympia",
        name: "Curling Brno",
        country: "ƒåesko",
        city: "Brno",
        region: "Europe",
        lat: 49.2104,
        lng: 16.6147,
        venue: { sheets: 4, indoor: true, address: "Nov√° Zbrojovka, Brno", opened: 2004 },
        website: "https://www.curlingbrno.cz/",
        notes: "St√°la curlingov√° hala v Brne.",
        tournaments: [
          { title: "Brno Open", start: "2025-11-07", end: "2025-11-09", url: "https://www.curlingbrno.cz/" },
          { title: "Jarn√Ω poh√°r", start: "2025-03-22", end: "2025-03-23", notes: "Rekreaƒçn√Ω turnaj" }
        ]
      },
      {
        id: "cze-praha-rozcestli",
        name: "Curling Praha ‚Äì Roztyly",
        country: "ƒåesko",
        city: "Praha",
        region: "Europe",
        lat: 50.0305,
        lng: 14.4807,
        venue: { sheets: 4, indoor: true, address: "Kom√°rkova 12, Praha 4", opened: 2004 },
        website: "https://www.curling.cz/",
        notes: "N√°rodn√© curlingov√© centrum.",
        tournaments: [
          { title: "Praha Classic", start: "2025-10-24", end: "2025-10-27", url: "https://www.worldcurlingtour.org/" },
          { title: "SM√ç≈†EN√â Dvojice Open", start: "2025-02-14", end: "2025-02-16" }
        ]
      },
      {
        id: "sui-zurich",
        name: "CC Z√ºrich (Bezirksanlage Dolder)",
        country: "≈†vajƒçiarsko",
        city: "Z√ºrich",
        region: "Europe",
        lat: 47.383,
        lng: 8.56,
        venue: { sheets: 5, indoor: true, address: "Adlisbergstrasse 36, 8044 Z√ºrich", opened: 1930 },
        website: "https://www.ccz.ch/",
        notes: "Historick√© curlingov√© z√°zemie.",
        tournaments: [
          { title: "Z√ºrich Cup", start: "2025-12-05", end: "2025-12-07" }
        ]
      },
      {
        id: "can-calgary-glencoe",
        name: "Glencoe Curling Club",
        country: "Kanada",
        city: "Calgary",
        region: "North America",
        lat: 51.041,
        lng: -114.077,
        venue: { sheets: 8, indoor: true, address: "636 29 Ave SW, Calgary, AB", opened: 1931 },
        website: "https://www.glencoecurlingclub.com/",
        notes: "Veƒæk√Ω klub so ≈°piƒçkovou infra≈°trukt√∫rou.",
        tournaments: [
          { title: "Glencoe Invitational", start: "2026-01-16", end: "2026-01-19" }
        ]
      }
    ];

    // ===== 2) MAPA =====
    const map = L.map('map', { zoomControl: true }).setView([30, 10], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM prispievatelia</a>'
    }).addTo(map);

    // Marker ikona pre curling ü•å ‚Äì jednoduch√° SVG
    const CurlingIcon = L.DivIcon.extend({
      options: {
        className: 'curling-icon',
        html: `<div style="width:26px;height:26px;border-radius:50%;background:#1b2a4a;border:2px solid #4da3ff;display:grid;place-items:center;box-shadow:0 0 0 2px rgba(77,163,255,.25)"><span style="font-size:14px">ü•å</span></div>`,
        iconSize: [26, 26],
        iconAnchor: [13, 13],
        popupAnchor: [0, -10]
      }
    });

    const clusterGroup = L.markerClusterGroup({
      chunkedLoading: true,
      showCoverageOnHover: false,
      spiderfyOnMaxZoom: true,
      disableClusteringAtZoom: 12
    });

    const markersById = new Map();

    function clubPopupHTML(c) {
      const v = c.venue || {};
      const sheets = v.sheets != null ? `${v.sheets} dr√°h` : 'nezn√°my poƒçet dr√°h';
      const indoor = v.indoor == null ? '' : (v.indoor ? '‚Ä¢ vn√∫torn√° hala' : '‚Ä¢ vonkaj≈°ie');
      const addr = v.address ? `<div class="small">üìç ${v.address}</div>` : '';
      const web = c.website ? `<a href="${c.website}" target="_blank" rel="noopener">Web</a>` : '';
      return `
        <div>
          <strong>${c.name}</strong><br/>
          <span class="small">${c.city}, ${c.country}</span>
          ${addr}
          <div class="small">üßä ${sheets} ${indoor}</div>
          <div class="btn-row" style="margin-top:6px">
            <button class="btn" onclick="selectClub('${c.id}')">Zobrazi≈• detail</button>
            ${web}
          </div>
        </div>
      `;
    }

    function addMarkers(data) {
      clusterGroup.clearLayers();
      markersById.clear();
      data.forEach(c => {
        const m = L.marker([c.lat, c.lng], { icon: new CurlingIcon() }).bindPopup(clubPopupHTML(c));
        m.on('click', () => selectClub(c.id));
        clusterGroup.addLayer(m);
        markersById.set(c.id, m);
      });
      map.addLayer(clusterGroup);
    }

    addMarkers(clubs);

    // ===== 3) BOƒåN√ù PANEL ‚Äì vyhƒæad√°vanie/filtre + v√Ωsledky =====
    const elSearch = document.getElementById('search');
    const elRegion = document.getElementById('region');
    const elIce = document.getElementById('iceFilter');
    const elResults = document.getElementById('results');
    const elStats = document.getElementById('stats');

    function normalize(s) { return (s || '').toString().toLowerCase(); }

    function filterClubs() {
      const q = normalize(elSearch.value);
      const region = elRegion.value;
      const ice = elIce.value; // ">=4", ">=2", "=1", ""

      let filtered = clubs.filter(c => {
        const hay = `${c.name} ${c.city} ${c.country} ${c.region} ${c.notes || ''}`.toLowerCase();
        const matchQ = !q || hay.includes(q);
        const matchR = !region || c.region === region;
        let matchI = true;
        if (ice) {
          const count = c.venue?.sheets ?? 0;
          if (ice.startsWith('>=')) {
            const n = parseInt(ice.replace('>=', ''), 10);
            matchI = count >= n;
          } else if (ice.startsWith('=')) {
            const n = parseInt(ice.replace('=', ''), 10);
            matchI = count === n;
          }
        }
        return matchQ && matchR && matchI;
      });

      // Re-render markers
      addMarkers(filtered);

      // Fit bounds na v√Ωsledky (ak s√∫)
      if (filtered.length) {
        const group = new L.featureGroup(filtered.map(c => L.marker([c.lat, c.lng])));
        const pad = { padding: [40, 40] };
        map.fitBounds(group.getBounds(), pad);
      }

      // Render v√Ωsledkov v zozname
      renderResults(filtered);

      // ≈†tatistiky
      elStats.innerHTML = '';
      const total = clubs.length;
      const shown = filtered.length;
      const continents = new Map();
      filtered.forEach(c => continents.set(c.region, (continents.get(c.region) || 0) + 1));
      const statEls = [
        chip(`${shown}/${total} klubov viditeƒæn√Ωch`),
        ...Array.from(continents.entries()).map(([k, v]) => chip(`${k || 'Unknown'}: ${v}`))
      ];
      statEls.forEach(ch => elStats.appendChild(ch));
    }

    function chip(text) { const s = document.createElement('span'); s.className = 'chip'; s.textContent = text; return s; }

    function renderResults(list) {
      elResults.innerHTML = '';
      if (!list.length) {
        elResults.innerHTML = '<div class="small">≈Ωiadne kluby nezodpovedaj√∫ filtru.</div>';
        return;
      }
      list
        .sort((a,b) => a.country.localeCompare(b.country) || a.city.localeCompare(b.city) || a.name.localeCompare(b.name))
        .forEach(c => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>${c.name}</h3>
            <div class="meta">${c.city}, ${c.country} ‚Ä¢ ${c.region || '‚Äì'}</div>
            <div class="detail">
              <strong>Hala:</strong> ${c.venue?.sheets ?? '?'} dr√°h ${c.venue?.indoor ? '(vn√∫torn√°)' : '(vonkaj≈°ie)'}
              ${c.website ? ` ‚Ä¢ <a href="${c.website}" target="_blank" rel="noopener">web</a>` : ''}
              ${c.notes ? `<div class="small" style="margin-top:6px">${c.notes}</div>` : ''}
            </div>
            <div class="btn-row">
              <button class="btn" data-id="${c.id}">Zobrazi≈• na mape</button>
              <button class="btn" data-id="${c.id}" data-action="detail">Turnaje & detail</button>
            </div>
          `;
          elResults.appendChild(card);
        });

      // Deleg√°cia klikov
      elResults.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          const action = e.currentTarget.getAttribute('data-action');
          if (action === 'detail') selectClub(id); else focusMarker(id);
        });
      });
    }

    function focusMarker(id) {
      const m = markersById.get(id);
      if (!m) return;
      const latlng = m.getLatLng();
      map.setView(latlng, Math.max(12, map.getZoom()));
      m.openPopup();
    }

    // ===== 4) DETAIL KLUBU (v boƒçnom paneli) =====
    function selectClub(id) {
      const c = clubs.find(x => x.id === id);
      if (!c) return;
      focusMarker(id);

      const v = c.venue || {};
      const tournaments = Array.from(c.tournaments || []);
      tournaments.sort((a,b) => new Date(a.start) - new Date(b.start));

      const today = new Date();
      const upcoming = tournaments.filter(t => new Date(t.end || t.start) >= today);
      const past = tournaments.filter(t => new Date(t.end || t.start) < today).reverse();

      const tItem = (t) => `<li>üìÖ ${fmtDate(t.start)}${t.end ? ' ‚Äì ' + fmtDate(t.end) : ''} ‚Ä¢ <strong>${t.title}</strong>${t.city ? ' ‚Äì ' + t.city : ''}${t.url ? ` ‚Äì <a href="${t.url}" target="_blank" rel="noopener">info</a>` : ''}${t.notes ? ` <span class="small">(${t.notes})</span>` : ''}</li>`;

      const html = `
        <div class="card">
          <h3>${c.name}</h3>
          <div class="meta">${c.city}, ${c.country} ‚Ä¢ ${c.region || '‚Äì'}</div>
          <div class="detail">
            <div>üßä <strong>${v.sheets ?? '?'} dr√°h</strong> ${v.indoor ? '(vn√∫torn√°)' : '(vonkaj≈°ie)'} ${v.opened ? `‚Ä¢ od ${v.opened}` : ''}</div>
            ${v.address ? `<div class="small">üìç ${v.address}</div>` : ''}
            ${c.website ? `<div class="small">üîó <a href="${c.website}" target="_blank" rel="noopener">${c.website}</a></div>` : ''}
          </div>
          <h4>Nadch√°dzaj√∫ce turnaje</h4>
          ${upcoming.length ? `<ul class="list">${upcoming.map(tItem).join('')}</ul>` : '<div class="small">≈Ωiadne napl√°novan√© turnaje.</div>'}
          <h4>Minul√© turnaje</h4>
          ${past.length ? `<ul class="list">${past.map(tItem).join('')}</ul>` : '<div class="small">Zatiaƒæ bez hist√≥rie.</div>'}
          <div class="btn-row" style="margin-top:10px">
            <button class="btn" onclick="copyClubJSON('${c.id}')">Skop√≠rova≈• JSON klubu</button>
            <button class="btn" onclick="zoomToRegion('${c.region}')">Pribl√≠≈æi≈• regi√≥n</button>
          </div>
        </div>
      `;

      // Vlo≈æi≈• nad v√Ωsledky
      elResults.innerHTML = html + elResults.innerHTML;
    }

    function fmtDate(s) {
      try {
        const d = new Date(s);
        return d.toLocaleDateString('sk-SK', { year: 'numeric', month: '2-digit', day: '2-digit' });
      } catch { return s; }
    }

    function copyClubJSON(id) {
      const c = clubs.find(x => x.id === id);
      if (!c) return;
      const text = JSON.stringify(c, null, 2);
      navigator.clipboard?.writeText(text);
      alert('JSON klubu skop√≠rovan√Ω do schr√°nky.');
    }

    function zoomToRegion(region) {
      if (!region) return;
      const boundsByRegion = {
        Europe: [[71, -25], [34, 45]],
        'North America': [[72, -170], [10, -50]],
        'South America': [[15, -82], [-55, -34]],
        Asia: [[80, 25], [0, 180]],
        Africa: [[37, -20], [-35, 55]],
        Oceania: [[0, 110], [-48, 180]]
      };
      const b = boundsByRegion[region];
      if (b) map.fitBounds(b, { padding: [40, 40] });
    }

    // Reakcie na filtre
    elSearch.addEventListener('input', filterClubs);
    elRegion.addEventListener('change', filterClubs);
    elIce.addEventListener('change', filterClubs);

    // Prv√Ω render
    filterClubs();

    // ===== 5) AKO PRIDA≈§ KLUB/TURNAJ ‚Äì n√°vod (konzumn√Ω text v konzole) =====
    console.info(`\nüß≠ Ako prida≈• klub:\n\n1) Skop√≠ruj objekt v poli 'clubs' a uprav polia: id, name, country, city, region, lat, lng.\n2) Dop√≠≈° 'venue': { sheets, indoor, address, opened } a 'website', 'notes' (voliteƒæn√©).\n3) Turnaje prid√°≈° do 'tournaments': [ { title, start: 'YYYY-MM-DD', end?, url?, notes? } ].\n4) Ulo≈æ s√∫bor ako index.html a nahraj do GitHub repo (main branch).\n5) Zapni GitHub Pages (Settings ‚Üí Pages ‚Üí Branch: main /root). Hotovo.\n\nTipy:\n‚Ä¢ D√°ta m√¥≈æe≈° ƒçasom presun√∫≈• do JSON s√∫boru (clubs.json) a naƒç√≠ta≈• cez fetch().\n‚Ä¢ Alebo pou≈æij Google Sheets ‚Üí Publish to web (CSV) ‚Üí stiahni a parse-ni do objektov.\n‚Ä¢ Pri stovk√°ch klubov nechaj zapnut√© zhlukovanie (MarkerCluster).\n`);
  </script>
</body>
</html>
